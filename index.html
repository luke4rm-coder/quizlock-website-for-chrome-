<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Quizlock – Student Check-in</title>
    <style>
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #f5f5f5;
        color: #111827;
        min-height: 100vh;
      }
      .app-shell {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .topbar {
        height: 56px;
        padding: 0 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid #e5e7eb;
        background: #ffffff;
      }
      .topbar-left {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
      }
      .logo-dot {
        width: 20px;
        height: 20px;
        border-radius: 999px;
        background: linear-gradient(135deg, #fb923c, #f97316);
        box-shadow: 0 0 8px rgba(248, 148, 54, 0.5);
      }
      .logo-text {
        letter-spacing: 0.05em;
        text-transform: uppercase;
        font-size: 14px;
        color: #111827;
      }
      .topbar-right .status-pill {
        border-radius: 999px;
        padding: 4px 10px;
        font-size: 12px;
        background: rgba(248, 113, 113, 0.12);
        color: #b91c1c;
        border: 1px solid rgba(248, 113, 113, 0.7);
        transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
      }
      .status-pill.unlocked {
        background: rgba(251, 191, 36, 0.18);
        color: #92400e;
        border-color: rgba(245, 158, 11, 0.8);
      }
      .layout {
        flex: 1;
        display: grid;
        grid-template-columns: minmax(0, 2.3fr) minmax(0, 1.2fr);
        gap: 20px;
        padding: 24px;
      }
      .card {
        background: #ffffff;
        border-radius: 16px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
        padding: 20px 22px 22px;
      }
      .quiz-card h1 {
        margin: 0 0 4px;
        font-size: 22px;
      }
      .subtitle {
        margin: 0 0 16px;
        font-size: 13px;
        color: #6b7280;
      }
      .question {
        margin: 14px 0;
        padding: 12px 14px;
        background: #f9fafb;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
      }
      .question-label {
        margin: 0 0 6px;
        font-size: 13px;
      }
      .text-input,
      .question input[type="text"],
      .question input[type="number"] {
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background: #ffffff;
        color: #111827;
        font-size: 14px;
        outline: none;
      }
      .text-input:focus,
      .question input[type="text"]:focus,
      .question input[type="number"]:focus {
        border-color: #fb923c;
        box-shadow: 0 0 0 1px rgba(248, 148, 54, 0.5);
      }
      .option-list {
        margin-top: 6px;
      }
      .option-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
        font-size: 14px;
      }
      .option-row input[type="radio"] {
        margin: 0;
        width: auto;
        padding: 0;
      }
      .primary-btn {
        margin-top: 16px;
        width: 160px;
        align-self: flex-end;
        padding: 10px 0;
        font-size: 14px;
        font-weight: 600;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        background: linear-gradient(135deg, #fb923c, #f97316);
        color: #ffffff;
        box-shadow: 0 10px 22px rgba(248, 148, 54, 0.35);
      }
      .primary-btn:hover {
        box-shadow: 0 14px 30px rgba(248, 148, 54, 0.5);
      }
      .message {
        text-align: left;
        font-size: 14px;
        margin-top: 10px;
      }
      .ok {
        color: #166534;
      }
      .error {
        color: #b91c1c;
      }
      .side-card h2 {
        margin-top: 0;
        font-size: 16px;
      }
      .pill-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        background: rgba(148, 163, 184, 0.15);
        border: 1px solid rgba(148, 163, 184, 0.35);
      }
      .pill-badge.ok {
        background: rgba(251, 191, 36, 0.15);
        border-color: rgba(245, 158, 11, 0.8);
        color: #92400e;
      }
      .pill-badge.error {
        background: rgba(248, 113, 113, 0.1);
        border-color: rgba(248, 113, 113, 0.6);
        color: #b91c1c;
      }
      .info-list {
        list-style: none;
        padding: 0;
        margin: 10px 0 6px;
        font-size: 13px;
      }
      .info-list li {
        margin-bottom: 6px;
      }
      .hint {
        margin-top: 10px;
        font-size: 12px;
        color: #6b7280;
      }
      @media (max-width: 900px) {
        .layout {
          grid-template-columns: minmax(0, 1fr);
        }
        .primary-btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <header class="topbar">
        <div class="topbar-left">
          <span class="logo-dot"></span>
          <span class="logo-text">Quizlock</span>
        </div>
        <div class="topbar-right">
          <span class="status-pill" id="topStatus">Locked</span>
        </div>
      </header>

      <main class="layout">
        <section class="card quiz-card">
          <h1>Check-in Quiz</h1>
          <p class="subtitle">Answer all questions correctly to unlock this session.</p>

          <div class="question">
            <p class="question-label"><strong>Student name (or ID)</strong></p>
            <input
              type="text"
              id="studentName"
              placeholder="Type your name"
              class="text-input"
            />
          </div>

          <!-- Questions will be inserted here -->
          <div id="questions"></div>

          <button class="primary-btn" onclick="checkQuiz()">Unlock</button>
          <div id="message" class="message"></div>
        </section>

        <aside class="card side-card">
          <h2>Session Info</h2>
          <ul class="info-list">
            <li><strong>Questions:</strong> <span id="questionCount">0</span></li>
            <li>
              <strong>Status:</strong>
              <span id="statusText" class="pill-badge error">Locked</span>
            </li>
            <li><strong>Mode:</strong> Practice / Warm-up</li>
          </ul>
          <p class="hint">Your teacher can change these questions at any time.</p>
        </aside>
      </main>
    </div>

    <script>
      // CHANGE THIS if you have a backend; leave as "" to disable sending
      const API_BASE = "http://localhost:4000"; // e.g. "http://localhost:4000" if you use the backend

      // Default questions (used if backend is not available)
      const DEFAULT_QUESTIONS = [
        {
          text: "1) What is 2 + 2?",
          options: ["3", "4", "5", "6"],
          correctIndex: 1,
        },
        {
          text: "2) What is the capital of France?",
          options: ["London", "Berlin", "Paris", "Rome"],
          correctIndex: 2,
        },
        {
          text: "3) What color do you get when you mix red and blue?",
          options: ["Green", "Purple", "Orange", "Yellow"],
          correctIndex: 1,
        },
        {
          text: "4) What is 5 × 3?",
          options: ["8", "10", "15", "20"],
          correctIndex: 2,
        },
        {
          text: "5) Which device is best for taking online quizzes?",
          options: ["Phone", "School Chromebook", "TV", "Game console"],
          correctIndex: 1,
        },
      ];

      let QUESTIONS = DEFAULT_QUESTIONS.slice();

      async function loadQuestions() {
        if (!API_BASE) {
          renderQuestions();
          return;
        }

        try {
          const res = await fetch(`${API_BASE}/questions`);
          if (!res.ok) {
            throw new Error("Server error: " + res.status);
          }
          const data = await res.json();
          if (Array.isArray(data) && data.length > 0) {
            QUESTIONS = data;
          } else {
            QUESTIONS = DEFAULT_QUESTIONS.slice();
          }
        } catch (err) {
          console.error("Failed to load questions from backend, using defaults", err);
          QUESTIONS = DEFAULT_QUESTIONS.slice();
        }

        renderQuestions();
      }

      function renderQuestions() {
        const container = document.getElementById("questions");
        container.innerHTML = "";
        document.getElementById("questionCount").textContent = QUESTIONS.length;

        QUESTIONS.forEach((q, index) => {
          const wrapper = document.createElement("div");
          wrapper.className = "question";

          const p = document.createElement("p");
          p.textContent = q.text;
          wrapper.appendChild(p);

          const list = document.createElement("div");
          list.className = "option-list";
          list.setAttribute("role", "radiogroup");

          q.options.forEach((opt, optIndex) => {
            const label = document.createElement("label");
            label.className = "option-row";

            const input = document.createElement("input");
            input.type = "radio";
            input.name = `q${index + 1}`;
            input.value = String(optIndex);

            const span = document.createElement("span");
            span.textContent = opt;

            label.appendChild(input);
            label.appendChild(span);
            list.appendChild(label);
          });

          wrapper.appendChild(list);
          container.appendChild(wrapper);
        });
      }

      async function sendResult(payload) {
        if (!API_BASE) return; // skip if no backend
        try {
          await fetch(`${API_BASE}/submitQuiz`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
        } catch (err) {
          console.error("Failed to send quiz result", err);
        }
      }

      async function checkQuiz() {
        const nameInput = document.getElementById("studentName");
        const studentName = nameInput.value.trim();

        let correctCount = 0;

        QUESTIONS.forEach((q, index) => {
          const selected = document.querySelector(
            `input[name="q${index + 1}"]:checked`
          );
          if (!selected) return;
          const chosenIndex = Number(selected.value);
          if (chosenIndex === Number(q.correctIndex)) {
            correctCount += 1;
          }
        });

        const totalQuestions = QUESTIONS.length;
        const allCorrect = correctCount === totalQuestions;
        const msg = document.getElementById("message");
        const statusText = document.getElementById("statusText");
        const topStatus = document.getElementById("topStatus");

        if (allCorrect) {
          msg.textContent = "✔ Unlocked! All answers are correct. You can now close this tab.";
          msg.className = "message ok";
          statusText.textContent = "Unlocked";
          statusText.classList.remove("error");
          statusText.classList.add("ok");
          topStatus.textContent = "Unlocked";
          topStatus.classList.add("unlocked");

          await sendResult({
            studentName,
            score: correctCount,
            totalQuestions,
            unlocked: true,
            timestamp: Date.now(),
          });
        } else {
          msg.textContent = `✖ ${correctCount} / ${totalQuestions} correct. Fix the answers and try again.`;
          msg.className = "message error";
          statusText.textContent = "Locked";
          statusText.classList.remove("ok");
          statusText.classList.add("error");
          topStatus.textContent = "Locked";
          topStatus.classList.remove("unlocked");

          await sendResult({
            studentName,
            score: correctCount,
            totalQuestions,
            unlocked: false,
            timestamp: Date.now(),
          });
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        if (API_BASE) {
          loadQuestions();
        } else {
          renderQuestions();
        }
      });
    </script>
  </body>
</html>
